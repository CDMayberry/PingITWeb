/**
 * SendBird JavaScript SDK v2.1.3
 */
var _isLeavingPage=!1;"object"==typeof window&&(window.onbeforeunload=function(){_isLeavingPage=!0}),function(e,n){"use strict";"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.sendbird=n()}(this,function(){"use strict";function e(e,n,s,r){var a=new XMLHttpRequest;a.open("POST",e),a.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),a.onload=function(){if(a.status>=t&&a.status<i){var e=a.responseText;s(JSON.parse(e))}else r(a.status,a.statusText)},a.send(JSON.stringify(n))}var n=!1,s=function(e){n&&console.log(e)},r=function(e){e=e||{};for(var n=arguments.length,s=1;n>s;s++)if(arguments[s])for(var r in arguments[s])arguments[s].hasOwnProperty(r)&&(e[r]=arguments[s][r]);return e},t=200,i=400,a=function(){function a(e){return g+"v"+c.replace(/[^(0-9)]/gi,"")+"/"+e}function o(e){f.app_id=e.app_id,f.guest_id=e.guest_id,f.user_name=e.user_name,f.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,f.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,b({successFunc:function(n){e.successFunc(n)},errorFunc:function(n,s){e.errorFunc(n,s)},async:e.async})}var c="1",u="wss://ws.jiver.co:9010",g="https://api.jiver.co/",l=null,d={MESG:"MESG",FILE:"FILE",LOGI:"LOGI",JOIN:"JOIN",SYSM:"SYSM",BRDM:"BRDM",MCUP:"MCUP",READ:"READ",TPST:"TPST",TPEN:"TPEN",PING:"PING",PONG:"PONG"},f={},p={},_=0,m=0,v=null,F=null,y=null,h=0,k=!1,M=0,S=1e4,T=function(e,n){switch(e){case d.MESG:N.onMessageReceived(JSON.parse(n));break;case d.SYSM:N.onSystemMessageReceived(JSON.parse(n));break;case d.FILE:N.onFileMessageReceived(JSON.parse(n));break;case d.BRDM:N.onBroadcastMessageReceived(JSON.parse(n));break;case d.MCUP:N.onMessagingChannelUpdateReceived(JSON.parse(n));break;case d.TPST:N.onTypeStartReceived(JSON.parse(n));break;case d.TPEN:N.onTypeEndReceived(JSON.parse(n));break;case d.PONG:s(d.PONG);break;case d.READ:N.onReadReceived(JSON.parse(n));break;default:N.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},R={successFunc:function(e){},errorFunc:function(e,n){console.log(e),console.log(n)}},N={onMessageReceived:function(e){console.log(e)},onSystemMessageReceived:function(e){console.log(e)},onFileMessageReceived:function(e){console.log(e)},onBroadcastMessageReceived:function(e){console.log(e)},onReadReceived:function(e){console.log(e)},onMessagingChannelUpdateReceived:function(e){console.log(e)},onTypeStartReceived:function(e){console.log(e)},onTypeEndReceived:function(e){console.log(e)},onMessageDelivery:function(e){console.log(e)},onUndefinedMessageReceived:function(e,n){s(e),s(n)}},O=6,b=function(n){s("=== Start SendBird SDK ===");var i=r({},R,n),o="guest_login/",c={guest_id:f.guest_id,app_id:f.app_id,nickname:f.user_name,image_url:f.image_url,access_token:f.access_token};e(a(o),c,function(e){e.error?i.errorFunc(t,e.message):(f.guest_key=e.key,i.successFunc({}))},function(e,n){i.errorFunc(e,n)})},P=function(n,i){s("=== Join Channel ===");var o=r({},R,i),c="channel_join/",u={app_id:f.app_id,session_key:f.guest_key,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(r(p,e),g=p,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},I=function(n,i){s("=== Leave Channel ===");var o=r({},R,i),c="channel_leave",u={app_id:f.app_id,session_key:f.guest_key,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},L=function(n,i){s("=== Member List ===");var o=r({},R,i),c="member_list/",u={app_id:f.app_id,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},D=function(n){s("=== Channel List ==="),n=r({},{limit:20,page:1,query:""},n);var i=r({},R,n),o="channel_list/",c={app_id:f.app_id,page:i.page,limit:i.limit,query:i.query},u={};e(a(o),c,function(e){e.error?i.errorFunc(t,e.message):(u=e,i.successFunc(u))},function(e,n){i.errorFunc(e,n)})},w=function(e){D(e)},E=function(n,i){s("=== Join Messaging Channel ===");var o=r({},R,i),c="messaging_join/",u={app_id:f.app_id,session_key:f.guest_key,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(r(p,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},C=function(n,i){s("=== Start Messaging ==="),n=n instanceof Array?n:new Array(n);var o=r({},R,i),c="messaging_start/",u={app_id:f.app_id,session_key:f.guest_key,guest_ids:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(r(p,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},J=function(n,i){s("=== Invite Messaging ==="),n=n instanceof Array?n:new Array(n);var o=r({},R,i),c="messaging_invite/",u={app_id:f.app_id,session_key:f.guest_key,channel_url:p.channel_url,guest_ids:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(r(p,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},G=function(n,i){s("=== End Messaging ===");var o=r({},R,i),c="messaging_end/",u={app_id:f.app_id,session_key:f.guest_key,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(r(p,e),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},U=function(n){s("=== Messaging Channel List ==="),n=r({},{limit:9999,page:1},n);var i=r({},R,n),o="messaging_list/",c={app_id:f.app_id,session_key:f.guest_key,page:i.page,limit:i.limit},u={};e(a(o),c,function(e){e.error?i.errorFunc(t,e.message):(u=e,i.successFunc(u))},function(e,n){i.errorFunc(e,n)})},j=function(n,i){s("=== Messaging Channel Info ===");var o=r({},R,i),c="messaging_info/",u={app_id:f.app_id,session_key:f.guest_key,channel_id:n};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):N.onMessagingChannelUpdateReceived(e)},function(e,n){o.errorFunc(e,n)})},W=function(n,i){s("=== Message Mark As Read ===");var o=r({},R,i),c="mark_as_read/",u={app_id:f.app_id,session_key:f.guest_key,channel_url:n},g={};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},x=function(n){s("=== Message Load More ==="),n=r({},{limit:20},n);var i=r({},R,n),o=(new Date).getTime(),c="message_list",u={app_id:f.app_id,session_key:f.guest_key,channel_url:p.channel_url,message_ts:0==m?o:m,prev_limit:i.limit,next_limit:0,include:!1},g=[];e(a(c),u,function(e){e.error?i.errorFunc(t,e.message):(e.messages.forEach(function(e,n){var s=JSON.parse(e.substring(4));0==m?m=s.ts:m>s.ts&&(m=s.ts),g.push(ce(e))}),i.successFunc({messages:g}))},function(e,n){i.errorFunc(e,n)})},A=function(n){s("=== User List ==="),n=r({},{token:"",page:1,limit:30},n);var i=r({},R,n),o="user_list/",c={app_id:f.app_id,session_key:f.guest_key,token:i.token,page:i.page,limit:i.limit};e(a(o),c,function(e){e.error?i.errorFunc(t,e.message):i.successFunc(e)},function(e,n){i.errorFunc(e,n)})},B=function(e,n){s("=== Upload File ===");var a=r({},R,n),o="upload_file/",u='{"app_id": "'+f.app_id+'"}',l=new FormData;l.append("meta",u),l.append("file",e);var d="",p=g+"v"+c.replace(/[^(0-9)]/gi,"")+"/"+o,_=new XMLHttpRequest;_.open("POST",p,a.async),_.onload=function(){if(_.status>=t&&_.status<i){var n=_.responseText,s=JSON.parse(n);s.error?a.errorFunc(t,s.message):(d={error:!1,url:s.url},ae({url:s.url,name:e.name,type:e.type,size:e.size,custom:""}),a.successFunc(d))}else a.errorFunc(_.status,_.statusText)},_.send(l)},q=function(){s("=== Typing Start ===");var e=(new Date).getTime();Z(d.TPST,{channel_id:p.id,time:e}),M=e,k=!0},z=function(){s("=== Typing End ===");var e=(new Date).getTime();Z(d.TPEN,{channel_id:p.id,time:e}),M=0,k=!1},H=(setInterval(function(){var e=(new Date).getTime();k&&e-M>S&&z()},S),function(n,i){s("=== Delete Message ===");var o=r({},R,i),c="message_delete/",u={app_id:f.app_id,session_key:f.guest_key,msg_id:n};e(a(c),u,function(e){e.error?o.errorFunc(t,e.message):o.successFunc(e)},function(e,n){o.errorFunc(e,n)})}),Y=function(e){s("=== Web Socket Connect ==="),V();var n=r({},R,e);l=new WebSocket(u),l.onopen=function(e){$(f.guest_key);var s=(new Date).getTime();if(ee(p.id,s)){var r={};n.successFunc(r)}else n.errorFunc(i,"WebSocket is not connected yet.");se(!0)},l.onmessage=function(e){_=(new Date).getTime();for(var n=e.data.split("\n"),s=0;s<n.length;s++)if(0!=n[s].trim().length){var r=n[s].substring(0,4),t=n[s].substring(4);if(0!==r.trim().length||0!==t.trim().length)if(r===d.PONG)re(!1);else if(r==d.MCUP){var i=JSON.parse(t);j(i.channel_id)}else T(r,t)}},l.onerror=function(e){s("=== Web Socket onerror ==="),s(e),_isLeavingPage||K(),se(!1),re(!1)},l.onclose=function(e){s("=== Web Socket onclose ==="),s(e),_isLeavingPage||K(),se(!1),re(!1)}},X=function(){s("=== Web Socket Disconnect ==="),Q()},K=function(){null==y?(s("=== Start Reconnect ==="),y=setTimeout(function(){Y(),y=null,s("=== Reconnect done ===")},3e3)):s("=== Reconnect is in progress. (skip) ===")},Q=function(){l&&V(),p={},m=0,v=null,F=null,y=null,h=0},V=function(){l&&(l.close(),l.onmessage=function(e){},l.onopen=function(e){},l.onerror=function(e){},l.onclose=function(e){},l=null),m=0},Z=function(e,n){var s=e+JSON.stringify(n)+"\n";try{if(1!=l.readyState)return!1;l.send(s)}catch(r){return console.log(r),!1}return!0},$=function(e){Z(d.LOGI,{key:e})},ee=function(e,n){return Z(d.JOIN,{channel_id:e,last_ts:n})},ne=function(){var e=(new Date).getTime();h=e,Z(d.PING,{id:e})},se=function(e){null!=v&&(clearInterval(v),v=null),e?(s("=== Start Pinger ==="),v=setInterval(function(){var e=(new Date).getTime(),n=e-_,r=parseInt(n/1e3);r>0&&r%5==0&&(s(d.PING),ne(),re(!0))},1e3)):s("=== Stop Pinger ===")},re=function(e){null!=F&&(clearInterval(F),F=null),e?(s("=== Start Watchdog ==="),F=setInterval(function(){var e=(new Date).getTime(),n=e-_,r=parseInt(n/1e3);r>=20&&(s("=== Watchdog Barks! ==="),se(!1),K())},4500)):s("=== Watchdog ===")},te=function(e,n){n=n||"";var s=Z(d.MESG,{channel_id:p.id,message:e,data:"",tid:n});N.onMessageDelivery({sent:s,message:e,data:"",id:n}),s&&setTimeout(function(){z()},100)},ie=function(e,n,s){s=s||"";var r=Z(d.MESG,{channel_id:p.id,message:e,data:n,tid:s});N.onMessageDelivery({sent:r,message:e,data:n,tid:s}),r&&setTimeout(function(){z()},100)},ae=function(e){Z(d.FILE,{channel_id:p.id,name:e.name,url:e.url,type:e.type,size:e.size,custom:e.custom})},oe=function(e){n=e},ce=function(e){var n=e.substring(0,4),s=JSON.parse(e.substring(4));return{cmd:n,payload:s}},ue=function(e){return e==d.MESG},ge=function(e){return e==d.FILE},le=function(e){var n=e.url.split("."),s=n[n.length-1];return"png"==s||"jpeg"==s||"jpg"==s||"gif"==s||"bmp"==s?!0:e.type.indexOf("image")>=0},de=function(e){return e==O},fe=function(e){e({channel_url:p.channel_url,cover_img_url:p.cover_img_url,member_count:p.member_count,name:p.name})},pe=function(e){e({guest_id:f.guest_id,image_url:f.image_url,nickname:f.user_name})},_e="[version] 2.1.3";return{version:_e,events:N,joinChannel:P,leaveChannel:I,getMemberList:L,getChannelSearch:D,getChannelList:w,joinMessagingChannel:E,startMessaging:C,inviteMessaging:J,endMessaging:G,getMessagingChannelList:U,markAsRead:W,getMessageLoadMore:x,getUserList:A,sendFile:B,typeStart:q,deleteMessage:H,connect:Y,disconnect:X,message:te,messageWithData:ie,sendFileURL:ae,setDebugMessage:oe,isMessage:ue,isFileMessage:ge,hasImage:le,isGroupMessaging:de,getChannelInfo:fe,getUserInfo:pe,init:o}}();return a});